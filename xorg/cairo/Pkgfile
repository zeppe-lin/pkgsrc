# Description: 2D graphics library with support for multiple output devices
# URL:         https://www.cairographics.org
# Depends on:  fontconfig glib lzo xorg-libpixman xorg-libxext xorg-libxrender

name=cairo
version=1.17.6
release=7n
source="https://gitlab.freedesktop.org/cairo/cairo/-/archive/$version/$name-$version.tar.bz2
	fix-cairo-sphinx.patch"

build() {
	patch -p1 -d $name-$version -i $SRC/fix-cairo-sphinx.patch

	if pkgman isinst wayland-protocols mesa; then
		PKGMK_CAIRO="-D gl-backend=glesv3 -D glesv3=enabled"
	fi

	meson setup build $name-$version  \
		--prefix=/usr             \
		--buildtype=plain         \
		--wrap-mode=nodownload    \
		-D b_lto=true             \
		-D b_pie=true             \
		-D tee=enabled            \
		-D spectre=disabled       \
		-D tests=disabled         \
		$PKGMK_CAIRO              \

	ninja -C build -j ${JOBS:-1} -v
	DESTDIR=$PKG ninja -C build install

	chmod +x $PKG/usr/bin/cairo-trace
}
